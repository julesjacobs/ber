- [x] Initial OCaml parser/CLI setup and .ber examples committed
- [x] Read AGENTS.md
- [x] HM inference plan and types: define core type representations, schemes, env and error reporting
- [x] AST type conversion and unification utilities (occurs check, substitution, generalize/instantiate)
- [x] Expression and pattern inference (let/letrec, match, functions, constructors) with ADT environment
- [x] Integrate #type pragma in CLI to output inferred types or type errors per toplevel
- [x] Refresh .ber outputs (especially #type cases) and sanity-check examples
- [x] Challenge corpus added under ber/challenges/ (kept out of ber.sh rewriting)
- [x] Fix ber-cli rewriting issues:
  - [x] Reproduce newline/output stripping bug locally
  - [x] Adjust parsing/emission to strip old outputs cleanly and avoid extra blank lines
  - [x] Run ./ber.sh and review fixture diffs
- [ ] Current CLI regressions to fix:
  - [x] Preserve original source formatting (avoid re-PPing code)
  - [x] Restore accurate error locations (respect original line numbers incl. pragmas)
  - [x] Support curried let sugar so challenges parse (negate/compose/etc.)
  - [x] Re-run ./ber.sh and verify fixtures/output stability
- [x] Code review OCaml sources (readability/organization/conciseness):
  - [x] Inventory OCaml modules/files to review
  - [x] Review parser/typechecker/CLI modules and note issues
  - [x] Summarize findings and recommendations
- [ ] Code review follow-ups:
  - [x] Keep type inference errors in `Result` flow; avoid uncaught `TypeError` from `infer_expr`/`register_type_decl` (src/type_infer.ml:415-622, 505-542)
    - [x] Add .ber fixture that currently crashes due to uncaught `TypeError`
    - [x] Refactor inference to stay in `Result` flow and surface locations
    - [x] Run `./ber.sh` and review fixture diffs
  - [ ] Deduplicate constructor handling in `infer_pattern`/`infer_expr` with a shared helper and single unify (src/type_infer.ml:284-361)
  - [ ] Remove or wire up unused buffered lexer helpers (src/parse.ml:22-50) in favor of the toplevel sync logic
  - [ ] Consolidate blank-line trimming in CLI and drop unused `pragmas` param in `process_block` (bin/ber_cli.ml:16-127)
  - [ ] Make `string_of_scheme` print quantified vars so generalized types are visible (src/type_infer.ml:195-199)
- [ ] Challenge corpus refresh:
  - [x] Audit existing `ber/challenges` cases against provided 22-example list
  - [x] Add missing challenge files and regenerate outputs
  - [x] Review diffs/output for the new challenges
